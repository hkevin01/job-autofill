<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Webcam Test - Job AutoFill</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .header {
        text-align: center;
        margin-bottom: 30px;
      }
      .video-section {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 30px;
      }
      video {
        max-width: 500px;
        width: 100%;
        border: 2px solid #ddd;
        border-radius: 8px;
        background: #000;
      }
      .controls {
        margin: 20px 0;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
      }
      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
      }
      .btn-primary {
        background: #007bff;
        color: white;
      }
      .btn-secondary {
        background: #6c757d;
        color: white;
      }
      .btn-success {
        background: #28a745;
        color: white;
      }
      .btn-danger {
        background: #dc3545;
        color: white;
      }
      .btn:hover {
        opacity: 0.9;
      }
      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      .preview-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 30px;
      }
      .preview-box {
        border: 2px dashed #ddd;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        min-height: 200px;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }
      .preview-box img {
        max-width: 100%;
        max-height: 300px;
        border-radius: 5px;
      }
      .settings {
        margin: 20px 0;
      }
      .setting-group {
        margin: 10px 0;
      }
      .setting-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
      }
      .setting-group select {
        width: 100%;
        max-width: 300px;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      .status {
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
      }
      .status.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .status.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .status.info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      @media (max-width: 768px) {
        .preview-section {
          grid-template-columns: 1fr;
        }
        .controls {
          flex-direction: column;
          align-items: center;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Job AutoFill - Webcam Test</h1>
        <p>Test the webcam capture functionality for profile images</p>
      </div>

      <div class="video-section">
        <video id="video" autoplay playsinline muted></video>
        <canvas id="canvas" style="display: none"></canvas>

        <div class="settings">
          <div class="setting-group">
            <label for="camera-select">Select Camera:</label>
            <select id="camera-select">
              <option value="">Loading cameras...</option>
            </select>
          </div>
          <div class="setting-group">
            <label for="resolution-select">Resolution:</label>
            <select id="resolution-select">
              <option value="640x480">640x480</option>
              <option value="1280x720" selected>1280x720 (HD)</option>
              <option value="1920x1080">1920x1080 (Full HD)</option>
            </select>
          </div>
        </div>

        <div class="controls">
          <button class="btn btn-primary" id="start-btn">Start Camera</button>
          <button class="btn btn-secondary" id="stop-btn" disabled>Stop Camera</button>
          <button class="btn btn-success" id="capture-left-btn" disabled>ðŸ“¸ Capture Left</button>
          <button class="btn btn-success" id="capture-right-btn" disabled>ðŸ“¸ Capture Right</button>
          <button class="btn btn-danger" id="clear-btn">Clear All</button>
        </div>

        <div id="status-messages"></div>
      </div>

      <div class="preview-section">
        <div class="preview-box" id="left-preview">
          <h3>Left Image</h3>
          <div id="left-placeholder">
            <p>ðŸ“· No image captured</p>
            <p>Click "Capture Left" to take a photo</p>
          </div>
        </div>
        <div class="preview-box" id="right-preview">
          <h3>Right Image</h3>
          <div id="right-placeholder">
            <p>ðŸ“· No image captured</p>
            <p>Click "Capture Right" to take a photo</p>
          </div>
        </div>
      </div>
    </div>

    <script>
      class WebcamTest {
        constructor() {
          this.video = document.getElementById('video');
          this.canvas = document.getElementById('canvas');
          this.ctx = this.canvas.getContext('2d');
          this.stream = null;
          this.devices = [];
          this.currentDeviceId = null;
          this.images = { left: null, right: null };

          this.initElements();
          this.setupEvents();
          this.loadDevices();
        }

        initElements() {
          this.startBtn = document.getElementById('start-btn');
          this.stopBtn = document.getElementById('stop-btn');
          this.captureLeftBtn = document.getElementById('capture-left-btn');
          this.captureRightBtn = document.getElementById('capture-right-btn');
          this.clearBtn = document.getElementById('clear-btn');
          this.cameraSelect = document.getElementById('camera-select');
          this.resolutionSelect = document.getElementById('resolution-select');
          this.statusMessages = document.getElementById('status-messages');
          this.leftPreview = document.getElementById('left-preview');
          this.rightPreview = document.getElementById('right-preview');
        }

        setupEvents() {
          this.startBtn.addEventListener('click', () => this.startCamera());
          this.stopBtn.addEventListener('click', () => this.stopCamera());
          this.captureLeftBtn.addEventListener('click', () => this.capture('left'));
          this.captureRightBtn.addEventListener('click', () => this.capture('right'));
          this.clearBtn.addEventListener('click', () => this.clearAll());
          this.cameraSelect.addEventListener('change', () => this.switchCamera());
          this.resolutionSelect.addEventListener('change', () => this.changeResolution());
        }

        async loadDevices() {
          try {
            const devices = await navigator.mediaDevices.enumerateDevices();
            this.devices = devices.filter(device => device.kind === 'videoinput');

            this.cameraSelect.innerHTML = '';
            if (this.devices.length === 0) {
              this.cameraSelect.innerHTML = '<option>No cameras found</option>';
              return;
            }

            this.devices.forEach((device, index) => {
              const option = document.createElement('option');
              option.value = device.deviceId;
              option.textContent = device.label || `Camera ${index + 1}`;
              this.cameraSelect.appendChild(option);
            });

            this.currentDeviceId = this.devices[0].deviceId;
            this.showStatus('Cameras loaded successfully', 'success');
          } catch (error) {
            this.showStatus('Error loading cameras: ' + error.message, 'error');
          }
        }

        async startCamera() {
          try {
            if (this.stream) {
              this.stopCamera();
            }

            const resolution = this.resolutionSelect.value.split('x');
            const constraints = {
              video: {
                deviceId: this.currentDeviceId ? { exact: this.currentDeviceId } : undefined,
                width: { ideal: parseInt(resolution[0]) },
                height: { ideal: parseInt(resolution[1]) },
              },
            };

            this.stream = await navigator.mediaDevices.getUserMedia(constraints);
            this.video.srcObject = this.stream;

            this.video.onloadedmetadata = () => {
              this.canvas.width = this.video.videoWidth;
              this.canvas.height = this.video.videoHeight;
            };

            this.startBtn.disabled = true;
            this.stopBtn.disabled = false;
            this.captureLeftBtn.disabled = false;
            this.captureRightBtn.disabled = false;

            this.showStatus('Camera started successfully', 'success');
          } catch (error) {
            this.showStatus('Error starting camera: ' + error.message, 'error');
          }
        }

        stopCamera() {
          if (this.stream) {
            this.stream.getTracks().forEach(track => track.stop());
            this.stream = null;
            this.video.srcObject = null;
          }

          this.startBtn.disabled = false;
          this.stopBtn.disabled = true;
          this.captureLeftBtn.disabled = true;
          this.captureRightBtn.disabled = true;

          this.showStatus('Camera stopped', 'info');
        }

        async switchCamera() {
          this.currentDeviceId = this.cameraSelect.value;
          if (this.stream) {
            this.stopCamera();
            setTimeout(() => this.startCamera(), 500);
          }
        }

        async changeResolution() {
          if (this.stream) {
            this.stopCamera();
            setTimeout(() => this.startCamera(), 500);
          }
        }

        capture(side) {
          if (!this.stream) {
            this.showStatus('Please start the camera first', 'error');
            return;
          }

          // Draw video frame to canvas
          this.ctx.drawImage(this.video, 0, 0, this.canvas.width, this.canvas.height);

          // Get image data
          const imageData = this.canvas.toDataURL('image/jpeg', 0.9);
          this.images[side] = imageData;

          // Update preview
          this.updatePreview(side, imageData);

          this.showStatus(`${side.charAt(0).toUpperCase() + side.slice(1)} image captured!`, 'success');
        }

        updatePreview(side, imageData) {
          const preview = document.getElementById(`${side}-preview`);
          const placeholder = document.getElementById(`${side}-placeholder`);

          // Remove placeholder if exists
          if (placeholder) {
            placeholder.remove();
          }

          // Remove existing image if any
          const existingImg = preview.querySelector('img');
          if (existingImg) {
            existingImg.remove();
          }

          // Add new image
          const img = document.createElement('img');
          img.src = imageData;
          img.alt = `${side} profile image`;
          preview.appendChild(img);

          // Add retake button
          const existingBtn = preview.querySelector('button');
          if (existingBtn) {
            existingBtn.remove();
          }

          const retakeBtn = document.createElement('button');
          retakeBtn.className = 'btn btn-secondary';
          retakeBtn.textContent = 'Retake';
          retakeBtn.style.marginTop = '10px';
          retakeBtn.addEventListener('click', () => this.capture(side));
          preview.appendChild(retakeBtn);
        }

        clearAll() {
          this.images = { left: null, right: null };

          // Reset previews
          ['left', 'right'].forEach(side => {
            const preview = document.getElementById(`${side}-preview`);
            preview.innerHTML = `
            <h3>${side.charAt(0).toUpperCase() + side.slice(1)} Image</h3>
            <div id="${side}-placeholder">
              <p>ðŸ“· No image captured</p>
              <p>Click "Capture ${side.charAt(0).toUpperCase() + side.slice(1)}" to take a photo</p>
            </div>
          `;
          });

          this.showStatus('All images cleared', 'info');
        }

        showStatus(message, type = 'info') {
          const status = document.createElement('div');
          status.className = `status ${type}`;
          status.textContent = message;

          this.statusMessages.appendChild(status);

          setTimeout(() => {
            if (status.parentNode) {
              status.parentNode.removeChild(status);
            }
          }, 3000);
        }
      }

      // Initialize when page loads
      document.addEventListener('DOMContentLoaded', () => {
        new WebcamTest();
      });
    </script>
  </body>
</html>
